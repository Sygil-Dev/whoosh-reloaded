<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>whoosh.scoring &mdash; Whoosh-Reloaded 2.7.5 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Whoosh-Reloaded
          </a>
              <div class="version">
                2.7
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../releases/index.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart.html">Quick start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../intro.html">Introduction to Whoosh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../schema.html">Designing a schema</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../indexing.html">How to index documents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../searching.html">How to search</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../parsing.html">Parsing user queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../querylang.html">The default query language</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dates.html">Indexing and parsing dates/times</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../query.html">Query objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analysis.html">About analyzers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../stemming.html">Stemming, variations, and accent folding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ngrams.html">Indexing and searching N-grams</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../facets.html">Sorting and faceting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../highlight.html">How to create highlighted search result excerpts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../keywords.html">Query expansion and Key word extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../spelling.html">“Did you mean… ?” Correcting errors in user queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fieldcaches.html">Field caches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../batch.html">Tips for speeding up batch indexing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../threads.html">Concurrency, locking, and versioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nested.html">Indexing and searching document hierarchies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../recipes.html">Whoosh recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/api.html">Whoosh API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tech/index.html">Technical notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Whoosh-Reloaded</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">whoosh.scoring</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for whoosh.scoring</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2008 Matt Chaput. All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># Redistribution and use in source and binary forms, with or without</span>
<span class="c1"># modification, are permitted provided that the following conditions are met:</span>
<span class="c1">#</span>
<span class="c1">#    1. Redistributions of source code must retain the above copyright notice,</span>
<span class="c1">#       this list of conditions and the following disclaimer.</span>
<span class="c1">#</span>
<span class="c1">#    2. Redistributions in binary form must reproduce the above copyright</span>
<span class="c1">#       notice, this list of conditions and the following disclaimer in the</span>
<span class="c1">#       documentation and/or other materials provided with the distribution.</span>
<span class="c1">#</span>
<span class="c1"># THIS SOFTWARE IS PROVIDED BY MATT CHAPUT ``AS IS&#39;&#39; AND ANY EXPRESS OR</span>
<span class="c1"># IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF</span>
<span class="c1"># MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO</span>
<span class="c1"># EVENT SHALL MATT CHAPUT OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,</span>
<span class="c1"># INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<span class="c1"># LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,</span>
<span class="c1"># OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF</span>
<span class="c1"># LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING</span>
<span class="c1"># NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,</span>
<span class="c1"># EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<span class="c1">#</span>
<span class="c1"># The views and conclusions contained in the software and documentation are</span>
<span class="c1"># those of the authors and should not be interpreted as representing official</span>
<span class="c1"># policies, either expressed or implied, of Matt Chaput.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module contains classes for scoring (and sorting) search results.</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">log</span><span class="p">,</span> <span class="n">pi</span>

<span class="c1"># Base classes</span>


<div class="viewcode-block" id="WeightingModel"><a class="viewcode-back" href="../../api/scoring.html#whoosh.scoring.WeightingModel">[docs]</a><span class="k">class</span> <span class="nc">WeightingModel</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Abstract base class for scoring models. A WeightingModel object provides</span>
<span class="sd">    a method, ``scorer``, which returns an instance of</span>
<span class="sd">    :class:`whoosh.scoring.Scorer`.</span>

<span class="sd">    Basically, WeightingModel objects store the configuration information for</span>
<span class="sd">    the model (for example, the values of B and K1 in the BM25F model), and</span>
<span class="sd">    then creates a scorer instance based on additional run-time information</span>
<span class="sd">    (the searcher, the fieldname, and term text) to do the actual scoring.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">use_final</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="WeightingModel.idf"><a class="viewcode-back" href="../../api/scoring.html#whoosh.scoring.WeightingModel.idf">[docs]</a>    <span class="k">def</span> <span class="nf">idf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">searcher</span><span class="p">,</span> <span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the inverse document frequency of the given term.&quot;&quot;&quot;</span>

        <span class="n">parent</span> <span class="o">=</span> <span class="n">searcher</span><span class="o">.</span><span class="n">get_parent</span><span class="p">()</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">doc_frequency</span><span class="p">(</span><span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        <span class="n">dc</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">doc_count_all</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">log</span><span class="p">(</span><span class="n">dc</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="WeightingModel.scorer"><a class="viewcode-back" href="../../api/scoring.html#whoosh.scoring.WeightingModel.scorer">[docs]</a>    <span class="k">def</span> <span class="nf">scorer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">searcher</span><span class="p">,</span> <span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">qf</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns an instance of :class:`whoosh.scoring.Scorer` configured</span>
<span class="sd">        for the given searcher, fieldname, and term text.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span></div>

<div class="viewcode-block" id="WeightingModel.final"><a class="viewcode-back" href="../../api/scoring.html#whoosh.scoring.WeightingModel.final">[docs]</a>    <span class="k">def</span> <span class="nf">final</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">searcher</span><span class="p">,</span> <span class="n">docnum</span><span class="p">,</span> <span class="n">score</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a final score for each document. You can use this method</span>
<span class="sd">        in subclasses to apply document-level adjustments to the score, for</span>
<span class="sd">        example using the value of stored field to influence the score</span>
<span class="sd">        (although that would be slow).</span>

<span class="sd">        WeightingModel sub-classes that use ``final()`` should have the</span>
<span class="sd">        attribute ``use_final`` set to ``True``.</span>

<span class="sd">        :param searcher: :class:`whoosh.searching.Searcher` for the index.</span>
<span class="sd">        :param docnum: the doc number of the document being scored.</span>
<span class="sd">        :param score: the document&#39;s accumulated term score.</span>

<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">score</span></div></div>


<div class="viewcode-block" id="BaseScorer"><a class="viewcode-back" href="../../api/scoring.html#whoosh.scoring.BaseScorer">[docs]</a><span class="k">class</span> <span class="nc">BaseScorer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for &quot;scorer&quot; implementations. A scorer provides a method for</span>
<span class="sd">    scoring a document, and sometimes methods for rating the &quot;quality&quot; of a</span>
<span class="sd">    document and a matcher&#39;s current &quot;block&quot;, to implement quality-based</span>
<span class="sd">    optimizations.</span>

<span class="sd">    Scorer objects are created by WeightingModel objects. Basically,</span>
<span class="sd">    WeightingModel objects store the configuration information for the model</span>
<span class="sd">    (for example, the values of B and K1 in the BM25F model), and then creates</span>
<span class="sd">    a scorer instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="BaseScorer.supports_block_quality"><a class="viewcode-back" href="../../api/scoring.html#whoosh.scoring.BaseScorer.supports_block_quality">[docs]</a>    <span class="k">def</span> <span class="nf">supports_block_quality</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns True if this class supports quality optimizations.&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="BaseScorer.score"><a class="viewcode-back" href="../../api/scoring.html#whoosh.scoring.BaseScorer.score">[docs]</a>    <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matcher</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a score for the current document of the matcher.&quot;&quot;&quot;</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span></div>

<div class="viewcode-block" id="BaseScorer.max_quality"><a class="viewcode-back" href="../../api/scoring.html#whoosh.scoring.BaseScorer.max_quality">[docs]</a>    <span class="k">def</span> <span class="nf">max_quality</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the *maximum limit* on the possible score the matcher can</span>
<span class="sd">        give. This can be an estimate and not necessarily the actual maximum</span>
<span class="sd">        score possible, but it must never be less than the actual maximum</span>
<span class="sd">        score.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span></div>

<div class="viewcode-block" id="BaseScorer.block_quality"><a class="viewcode-back" href="../../api/scoring.html#whoosh.scoring.BaseScorer.block_quality">[docs]</a>    <span class="k">def</span> <span class="nf">block_quality</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matcher</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the *maximum limit* on the possible score the matcher can</span>
<span class="sd">        give **in its current &quot;block&quot;** (whatever concept of &quot;block&quot; the</span>
<span class="sd">        backend might use). This can be an estimate and not necessarily the</span>
<span class="sd">        actual maximum score possible, but it must never be less than the</span>
<span class="sd">        actual maximum score.</span>

<span class="sd">        If this score is less than the minimum score</span>
<span class="sd">        required to make the &quot;top N&quot; results, then we can tell the matcher to</span>
<span class="sd">        skip ahead to another block with better &quot;quality&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span></div></div>


<span class="c1"># Scorer that just returns term weight</span>


<div class="viewcode-block" id="WeightScorer"><a class="viewcode-back" href="../../api/scoring.html#whoosh.scoring.WeightScorer">[docs]</a><span class="k">class</span> <span class="nc">WeightScorer</span><span class="p">(</span><span class="n">BaseScorer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A scorer that simply returns the weight as the score. This is useful</span>
<span class="sd">    for more complex weighting models to return when they are asked for a</span>
<span class="sd">    scorer for fields that aren&#39;t scorable (don&#39;t store field lengths).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maxweight</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_maxweight</span> <span class="o">=</span> <span class="n">maxweight</span>

    <span class="k">def</span> <span class="nf">supports_block_quality</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matcher</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">matcher</span><span class="o">.</span><span class="n">weight</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">max_quality</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maxweight</span>

    <span class="k">def</span> <span class="nf">block_quality</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matcher</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">matcher</span><span class="o">.</span><span class="n">block_max_weight</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">for_</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">searcher</span><span class="p">,</span> <span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="n">ti</span> <span class="o">=</span> <span class="n">searcher</span><span class="o">.</span><span class="n">term_info</span><span class="p">(</span><span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">ti</span><span class="o">.</span><span class="n">max_weight</span><span class="p">())</span></div>


<span class="c1"># Base scorer for models that only use weight and field length</span>


<div class="viewcode-block" id="WeightLengthScorer"><a class="viewcode-back" href="../../api/scoring.html#whoosh.scoring.WeightLengthScorer">[docs]</a><span class="k">class</span> <span class="nc">WeightLengthScorer</span><span class="p">(</span><span class="n">BaseScorer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for scorers where the only per-document variables are term</span>
<span class="sd">    weight and field length.</span>

<span class="sd">    Subclasses should override the ``_score(weight, length)`` method to return</span>
<span class="sd">    the score for a document with the given weight and length, and call the</span>
<span class="sd">    ``setup()`` method at the end of the initializer to set up common</span>
<span class="sd">    attributes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">searcher</span><span class="p">,</span> <span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes the scorer and then does the busy work of</span>
<span class="sd">        adding the ``dfl()`` function and maximum quality attribute.</span>

<span class="sd">        This method assumes the initializers of WeightLengthScorer subclasses</span>
<span class="sd">        always take ``searcher, offset, fieldname, text`` as the first three</span>
<span class="sd">        arguments. Any additional arguments given to this method are passed</span>
<span class="sd">        through to the initializer.</span>

<span class="sd">        Note: this method calls ``self._score()``, so you should only call it</span>
<span class="sd">        in the initializer after setting up whatever attributes ``_score()``</span>
<span class="sd">        depends on::</span>

<span class="sd">            class MyScorer(WeightLengthScorer):</span>
<span class="sd">                def __init__(self, searcher, fieldname, text, parm=1.0):</span>
<span class="sd">                    self.parm = parm</span>
<span class="sd">                    self.setup(searcher, fieldname, text)</span>

<span class="sd">                def _score(self, weight, length):</span>
<span class="sd">                    return (weight / (length + 1)) * self.parm</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ti</span> <span class="o">=</span> <span class="n">searcher</span><span class="o">.</span><span class="n">term_info</span><span class="p">(</span><span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">searcher</span><span class="o">.</span><span class="n">schema</span><span class="p">[</span><span class="n">fieldname</span><span class="p">]</span><span class="o">.</span><span class="n">scorable</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">WeightScorer</span><span class="p">(</span><span class="n">ti</span><span class="o">.</span><span class="n">max_weight</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dfl</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">docid</span><span class="p">:</span> <span class="n">searcher</span><span class="o">.</span><span class="n">doc_field_length</span><span class="p">(</span><span class="n">docid</span><span class="p">,</span> <span class="n">fieldname</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_maxquality</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score</span><span class="p">(</span><span class="n">ti</span><span class="o">.</span><span class="n">max_weight</span><span class="p">(),</span> <span class="n">ti</span><span class="o">.</span><span class="n">min_length</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">supports_block_quality</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matcher</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score</span><span class="p">(</span><span class="n">matcher</span><span class="o">.</span><span class="n">weight</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dfl</span><span class="p">(</span><span class="n">matcher</span><span class="o">.</span><span class="n">id</span><span class="p">()))</span>

    <span class="k">def</span> <span class="nf">max_quality</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maxquality</span>

    <span class="k">def</span> <span class="nf">block_quality</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matcher</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score</span><span class="p">(</span><span class="n">matcher</span><span class="o">.</span><span class="n">block_max_weight</span><span class="p">(),</span> <span class="n">matcher</span><span class="o">.</span><span class="n">block_min_length</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
        <span class="c1"># Override this method with the actual scoring function</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span></div>


<span class="c1"># WeightingModel implementations</span>

<span class="c1"># Debugging model</span>


<span class="k">class</span> <span class="nc">DebugModel</span><span class="p">(</span><span class="n">WeightingModel</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">scorer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">searcher</span><span class="p">,</span> <span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">qf</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">DebugScorer</span><span class="p">(</span><span class="n">searcher</span><span class="p">,</span> <span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">DebugScorer</span><span class="p">(</span><span class="n">BaseScorer</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">searcher</span><span class="p">,</span> <span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">log</span><span class="p">):</span>
        <span class="n">ti</span> <span class="o">=</span> <span class="n">searcher</span><span class="o">.</span><span class="n">term_info</span><span class="p">(</span><span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_maxweight</span> <span class="o">=</span> <span class="n">ti</span><span class="o">.</span><span class="n">max_weight</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">searcher</span> <span class="o">=</span> <span class="n">searcher</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fieldname</span> <span class="o">=</span> <span class="n">fieldname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">log</span>

    <span class="k">def</span> <span class="nf">supports_block_quality</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matcher</span><span class="p">):</span>
        <span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fieldname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span>
        <span class="n">docid</span> <span class="o">=</span> <span class="n">matcher</span><span class="o">.</span><span class="n">id</span><span class="p">()</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">matcher</span><span class="o">.</span><span class="n">weight</span><span class="p">()</span>
        <span class="n">length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">searcher</span><span class="o">.</span><span class="n">doc_field_length</span><span class="p">(</span><span class="n">docid</span><span class="p">,</span> <span class="n">fieldname</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">docid</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">length</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">w</span>

    <span class="k">def</span> <span class="nf">max_quality</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maxweight</span>

    <span class="k">def</span> <span class="nf">block_quality</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matcher</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">matcher</span><span class="o">.</span><span class="n">block_max_weight</span><span class="p">()</span>


<span class="c1"># BM25F Model</span>


<span class="k">def</span> <span class="nf">bm25</span><span class="p">(</span><span class="n">idf</span><span class="p">,</span> <span class="n">tf</span><span class="p">,</span> <span class="n">fl</span><span class="p">,</span> <span class="n">avgfl</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">K1</span><span class="p">):</span>
    <span class="c1"># idf - inverse document frequency</span>
    <span class="c1"># tf - term frequency in the current document</span>
    <span class="c1"># fl - field length in the current document</span>
    <span class="c1"># avgfl - average field length across documents in collection</span>
    <span class="c1"># B, K1 - free paramters</span>

    <span class="k">return</span> <span class="n">idf</span> <span class="o">*</span> <span class="p">((</span><span class="n">tf</span> <span class="o">*</span> <span class="p">(</span><span class="n">K1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">tf</span> <span class="o">+</span> <span class="n">K1</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">B</span><span class="p">)</span> <span class="o">+</span> <span class="n">B</span> <span class="o">*</span> <span class="n">fl</span> <span class="o">/</span> <span class="n">avgfl</span><span class="p">)))</span>


<div class="viewcode-block" id="BM25F"><a class="viewcode-back" href="../../api/scoring.html#whoosh.scoring.BM25F">[docs]</a><span class="k">class</span> <span class="nc">BM25F</span><span class="p">(</span><span class="n">WeightingModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Implements the BM25F scoring algorithm.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">K1</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        &gt;&gt;&gt; from whoosh import scoring</span>
<span class="sd">        &gt;&gt;&gt; # Set a custom B value for the &quot;content&quot; field</span>
<span class="sd">        &gt;&gt;&gt; w = scoring.BM25F(B=0.75, content_B=1.0, K1=1.5)</span>

<span class="sd">        :param B: free parameter, see the BM25 literature. Keyword arguments of</span>
<span class="sd">            the form ``fieldname_B`` (for example, ``body_B``) set field-</span>
<span class="sd">            specific values for B.</span>
<span class="sd">        :param K1: free parameter, see the BM25 literature.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">=</span> <span class="n">B</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">K1</span> <span class="o">=</span> <span class="n">K1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_field_B</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_B&quot;</span><span class="p">):</span>
                <span class="n">fieldname</span> <span class="o">=</span> <span class="n">k</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_field_B</span><span class="p">[</span><span class="n">fieldname</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

    <span class="k">def</span> <span class="nf">supports_block_quality</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">scorer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">searcher</span><span class="p">,</span> <span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">qf</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">searcher</span><span class="o">.</span><span class="n">schema</span><span class="p">[</span><span class="n">fieldname</span><span class="p">]</span><span class="o">.</span><span class="n">scorable</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">WeightScorer</span><span class="o">.</span><span class="n">for_</span><span class="p">(</span><span class="n">searcher</span><span class="p">,</span> <span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fieldname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_field_B</span><span class="p">:</span>
            <span class="n">B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_field_B</span><span class="p">[</span><span class="n">fieldname</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span>

        <span class="k">return</span> <span class="n">BM25FScorer</span><span class="p">(</span><span class="n">searcher</span><span class="p">,</span> <span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">K1</span><span class="p">,</span> <span class="n">qf</span><span class="o">=</span><span class="n">qf</span><span class="p">)</span></div>


<span class="k">class</span> <span class="nc">BM25FScorer</span><span class="p">(</span><span class="n">WeightLengthScorer</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">searcher</span><span class="p">,</span> <span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">K1</span><span class="p">,</span> <span class="n">qf</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="c1"># IDF and average field length are global statistics, so get them from</span>
        <span class="c1"># the top-level searcher</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="n">searcher</span><span class="o">.</span><span class="n">get_parent</span><span class="p">()</span>  <span class="c1"># Returns self if no parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idf</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">idf</span><span class="p">(</span><span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">avgfl</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">avg_field_length</span><span class="p">(</span><span class="n">fieldname</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">=</span> <span class="n">B</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">K1</span> <span class="o">=</span> <span class="n">K1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qf</span> <span class="o">=</span> <span class="n">qf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">searcher</span><span class="p">,</span> <span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">bm25</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idf</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">avgfl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">K1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span>


<span class="c1"># DFree model</span>


<span class="k">def</span> <span class="nf">dfree</span><span class="p">(</span><span class="n">tf</span><span class="p">,</span> <span class="n">cf</span><span class="p">,</span> <span class="n">qf</span><span class="p">,</span> <span class="n">dl</span><span class="p">,</span> <span class="n">fl</span><span class="p">):</span>
    <span class="c1"># tf - term frequency in current document</span>
    <span class="c1"># cf - term frequency in collection</span>
    <span class="c1"># qf - term frequency in query</span>
    <span class="c1"># dl - field length in current document</span>
    <span class="c1"># fl - total field length across all documents in collection</span>
    <span class="n">prior</span> <span class="o">=</span> <span class="n">tf</span> <span class="o">/</span> <span class="n">dl</span>
    <span class="n">post</span> <span class="o">=</span> <span class="p">(</span><span class="n">tf</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">dl</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">invpriorcol</span> <span class="o">=</span> <span class="n">fl</span> <span class="o">/</span> <span class="n">cf</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">tf</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">post</span> <span class="o">/</span> <span class="n">prior</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="n">qf</span>
        <span class="o">*</span> <span class="n">norm</span>
        <span class="o">*</span> <span class="p">(</span>
            <span class="n">tf</span> <span class="o">*</span> <span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">prior</span> <span class="o">*</span> <span class="n">invpriorcol</span><span class="p">))</span>
            <span class="o">+</span> <span class="p">(</span><span class="n">tf</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">post</span> <span class="o">*</span> <span class="n">invpriorcol</span><span class="p">))</span>
            <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">post</span> <span class="o">/</span> <span class="n">prior</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>


<span class="k">class</span> <span class="nc">DFree</span><span class="p">(</span><span class="n">WeightingModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Implements the DFree scoring model from Terrier.</span>

<span class="sd">    See http://terrier.org/</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">supports_block_quality</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">scorer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">searcher</span><span class="p">,</span> <span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">qf</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">searcher</span><span class="o">.</span><span class="n">schema</span><span class="p">[</span><span class="n">fieldname</span><span class="p">]</span><span class="o">.</span><span class="n">scorable</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">WeightScorer</span><span class="o">.</span><span class="n">for_</span><span class="p">(</span><span class="n">searcher</span><span class="p">,</span> <span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">DFreeScorer</span><span class="p">(</span><span class="n">searcher</span><span class="p">,</span> <span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">qf</span><span class="o">=</span><span class="n">qf</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">DFreeScorer</span><span class="p">(</span><span class="n">WeightLengthScorer</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">searcher</span><span class="p">,</span> <span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">qf</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="c1"># Total term weight and total field length are global statistics, so</span>
        <span class="c1"># get them from the top-level searcher</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="n">searcher</span><span class="o">.</span><span class="n">get_parent</span><span class="p">()</span>  <span class="c1"># Returns self if no parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cf</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fl</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">field_length</span><span class="p">(</span><span class="n">fieldname</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">qf</span> <span class="o">=</span> <span class="n">qf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">searcher</span><span class="p">,</span> <span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">dfree</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qf</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fl</span><span class="p">)</span>


<span class="c1"># PL2 model</span>

<span class="n">rec_log2_of_e</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">pl2</span><span class="p">(</span><span class="n">tf</span><span class="p">,</span> <span class="n">cf</span><span class="p">,</span> <span class="n">qf</span><span class="p">,</span> <span class="n">dc</span><span class="p">,</span> <span class="n">fl</span><span class="p">,</span> <span class="n">avgfl</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="c1"># tf - term frequency in the current document</span>
    <span class="c1"># cf - term frequency in the collection</span>
    <span class="c1"># qf - term frequency in the query</span>
    <span class="c1"># dc - doc count</span>
    <span class="c1"># fl - field length in the current document</span>
    <span class="c1"># avgfl - average field length across all documents</span>
    <span class="c1"># c -free parameter</span>

    <span class="n">TF</span> <span class="o">=</span> <span class="n">tf</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="n">avgfl</span><span class="p">)</span> <span class="o">/</span> <span class="n">fl</span><span class="p">)</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">TF</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span> <span class="o">/</span> <span class="n">dc</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">norm</span>
        <span class="o">*</span> <span class="n">qf</span>
        <span class="o">*</span> <span class="p">(</span>
            <span class="n">TF</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">f</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">f</span> <span class="o">*</span> <span class="n">rec_log2_of_e</span>
            <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">TF</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">TF</span> <span class="o">*</span> <span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">TF</span><span class="p">)</span> <span class="o">-</span> <span class="n">rec_log2_of_e</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>


<span class="k">class</span> <span class="nc">PL2</span><span class="p">(</span><span class="n">WeightingModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Implements the PL2 scoring model from Terrier.</span>

<span class="sd">    See http://terrier.org/</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">c</span>

    <span class="k">def</span> <span class="nf">scorer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">searcher</span><span class="p">,</span> <span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">qf</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">searcher</span><span class="o">.</span><span class="n">schema</span><span class="p">[</span><span class="n">fieldname</span><span class="p">]</span><span class="o">.</span><span class="n">scorable</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">WeightScorer</span><span class="o">.</span><span class="n">for_</span><span class="p">(</span><span class="n">searcher</span><span class="p">,</span> <span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">PL2Scorer</span><span class="p">(</span><span class="n">searcher</span><span class="p">,</span> <span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="n">qf</span><span class="o">=</span><span class="n">qf</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">PL2Scorer</span><span class="p">(</span><span class="n">WeightLengthScorer</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">searcher</span><span class="p">,</span> <span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">qf</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="c1"># Total term weight, document count, and average field length are</span>
        <span class="c1"># global statistics, so get them from the top-level searcher</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="n">searcher</span><span class="o">.</span><span class="n">get_parent</span><span class="p">()</span>  <span class="c1"># Returns self if no parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cf</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">frequency</span><span class="p">(</span><span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dc</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">doc_count_all</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">avgfl</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">avg_field_length</span><span class="p">(</span><span class="n">fieldname</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">c</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qf</span> <span class="o">=</span> <span class="n">qf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">searcher</span><span class="p">,</span> <span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">pl2</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dc</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">avgfl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">)</span>


<span class="c1"># Simple models</span>


<div class="viewcode-block" id="Frequency"><a class="viewcode-back" href="../../api/scoring.html#whoosh.scoring.Frequency">[docs]</a><span class="k">class</span> <span class="nc">Frequency</span><span class="p">(</span><span class="n">WeightingModel</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">scorer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">searcher</span><span class="p">,</span> <span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">qf</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">maxweight</span> <span class="o">=</span> <span class="n">searcher</span><span class="o">.</span><span class="n">term_info</span><span class="p">(</span><span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">max_weight</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">WeightScorer</span><span class="p">(</span><span class="n">maxweight</span><span class="p">)</span></div>


<div class="viewcode-block" id="TF_IDF"><a class="viewcode-back" href="../../api/scoring.html#whoosh.scoring.TF_IDF">[docs]</a><span class="k">class</span> <span class="nc">TF_IDF</span><span class="p">(</span><span class="n">WeightingModel</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">scorer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">searcher</span><span class="p">,</span> <span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">qf</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="c1"># IDF is a global statistic, so get it from the top-level searcher</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="n">searcher</span><span class="o">.</span><span class="n">get_parent</span><span class="p">()</span>  <span class="c1"># Returns self if no parent</span>
        <span class="n">idf</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">idf</span><span class="p">(</span><span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

        <span class="n">maxweight</span> <span class="o">=</span> <span class="n">searcher</span><span class="o">.</span><span class="n">term_info</span><span class="p">(</span><span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">max_weight</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">TF_IDFScorer</span><span class="p">(</span><span class="n">maxweight</span><span class="p">,</span> <span class="n">idf</span><span class="p">)</span></div>


<span class="k">class</span> <span class="nc">TF_IDFScorer</span><span class="p">(</span><span class="n">BaseScorer</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maxweight</span><span class="p">,</span> <span class="n">idf</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_maxquality</span> <span class="o">=</span> <span class="n">maxweight</span> <span class="o">*</span> <span class="n">idf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idf</span> <span class="o">=</span> <span class="n">idf</span>

    <span class="k">def</span> <span class="nf">supports_block_quality</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matcher</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">matcher</span><span class="o">.</span><span class="n">weight</span><span class="p">()</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">idf</span>

    <span class="k">def</span> <span class="nf">max_quality</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maxquality</span>

    <span class="k">def</span> <span class="nf">block_quality</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matcher</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">matcher</span><span class="o">.</span><span class="n">block_max_weight</span><span class="p">()</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">idf</span>


<span class="c1"># Utility models</span>


<span class="k">class</span> <span class="nc">Weighting</span><span class="p">(</span><span class="n">WeightingModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This class provides backwards-compatibility with the old weighting</span>
<span class="sd">    class architecture, so any existing custom scorers don&#39;t need to be</span>
<span class="sd">    rewritten.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">scorer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">searcher</span><span class="p">,</span> <span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">qf</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">CompatibilityScorer</span><span class="p">(</span><span class="n">searcher</span><span class="p">,</span> <span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">score</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">searcher</span><span class="p">,</span> <span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">docnum</span><span class="p">,</span> <span class="n">weight</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">class</span> <span class="nc">CompatibilityScorer</span><span class="p">(</span><span class="n">BaseScorer</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">searcher</span><span class="p">,</span> <span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">scoremethod</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">searcher</span> <span class="o">=</span> <span class="n">searcher</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fieldname</span> <span class="o">=</span> <span class="n">fieldname</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scoremethod</span> <span class="o">=</span> <span class="n">scoremethod</span>

        <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matcher</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoremethod</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">searcher</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fieldname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">matcher</span><span class="o">.</span><span class="n">id</span><span class="p">(),</span> <span class="n">matcher</span><span class="o">.</span><span class="n">weight</span><span class="p">()</span>
            <span class="p">)</span>


<div class="viewcode-block" id="FunctionWeighting"><a class="viewcode-back" href="../../api/scoring.html#whoosh.scoring.FunctionWeighting">[docs]</a><span class="k">class</span> <span class="nc">FunctionWeighting</span><span class="p">(</span><span class="n">WeightingModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Uses a supplied function to do the scoring. For simple scoring functions</span>
<span class="sd">    and experiments this may be simpler to use than writing a full weighting</span>
<span class="sd">    model class and scorer class.</span>

<span class="sd">    The function should accept the arguments</span>
<span class="sd">    ``searcher, fieldname, text, matcher``.</span>

<span class="sd">    For example, the following function will score documents based on the</span>
<span class="sd">    earliest position of the query term in the document::</span>

<span class="sd">        def pos_score_fn(searcher, fieldname, text, matcher):</span>
<span class="sd">            poses = matcher.value_as(&quot;positions&quot;)</span>
<span class="sd">            return 1.0 / (poses[0] + 1)</span>

<span class="sd">        pos_weighting = scoring.FunctionWeighting(pos_score_fn)</span>
<span class="sd">        with myindex.searcher(weighting=pos_weighting) as s:</span>
<span class="sd">            results = s.search(q)</span>

<span class="sd">    Note that the searcher passed to the function may be a per-segment searcher</span>
<span class="sd">    for performance reasons. If you want to get global statistics inside the</span>
<span class="sd">    function, you should use ``searcher.get_parent()`` to get the top-level</span>
<span class="sd">    searcher. (However, if you are using global statistics, you should probably</span>
<span class="sd">    write a real model/scorer combo so you can cache them on the object.)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fn</span> <span class="o">=</span> <span class="n">fn</span>

    <span class="k">def</span> <span class="nf">scorer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">searcher</span><span class="p">,</span> <span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">qf</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">FunctionScorer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">,</span> <span class="n">searcher</span><span class="p">,</span> <span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">qf</span><span class="o">=</span><span class="n">qf</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">FunctionScorer</span><span class="p">(</span><span class="n">BaseScorer</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">searcher</span><span class="p">,</span> <span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">qf</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fn</span> <span class="o">=</span> <span class="n">fn</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">searcher</span> <span class="o">=</span> <span class="n">searcher</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fieldname</span> <span class="o">=</span> <span class="n">fieldname</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qf</span> <span class="o">=</span> <span class="n">qf</span>

        <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matcher</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">searcher</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fieldname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">matcher</span><span class="p">)</span></div>


<div class="viewcode-block" id="MultiWeighting"><a class="viewcode-back" href="../../api/scoring.html#whoosh.scoring.MultiWeighting">[docs]</a><span class="k">class</span> <span class="nc">MultiWeighting</span><span class="p">(</span><span class="n">WeightingModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Chooses from multiple scoring algorithms based on the field.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default</span><span class="p">,</span> <span class="o">**</span><span class="n">weightings</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The only non-keyword argument specifies the default</span>
<span class="sd">        :class:`Weighting` instance to use. Keyword arguments specify</span>
<span class="sd">        Weighting instances for specific fields.</span>

<span class="sd">        For example, to use ``BM25`` for most fields, but ``Frequency`` for</span>
<span class="sd">        the ``id`` field and ``TF_IDF`` for the ``keys`` field::</span>

<span class="sd">            mw = MultiWeighting(BM25(), id=Frequency(), keys=TF_IDF())</span>

<span class="sd">        :param default: the Weighting instance to use for fields not</span>
<span class="sd">            specified in the keyword arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">default</span>
        <span class="c1"># Store weighting functions by field name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weightings</span> <span class="o">=</span> <span class="n">weightings</span>

    <span class="k">def</span> <span class="nf">scorer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">searcher</span><span class="p">,</span> <span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">qf</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weightings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">fieldname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">w</span><span class="o">.</span><span class="n">scorer</span><span class="p">(</span><span class="n">searcher</span><span class="p">,</span> <span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">qf</span><span class="o">=</span><span class="n">qf</span><span class="p">)</span></div>


<div class="viewcode-block" id="ReverseWeighting"><a class="viewcode-back" href="../../api/scoring.html#whoosh.scoring.ReverseWeighting">[docs]</a><span class="k">class</span> <span class="nc">ReverseWeighting</span><span class="p">(</span><span class="n">WeightingModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wraps a weighting object and subtracts the wrapped model&#39;s scores from</span>
<span class="sd">    0, essentially reversing the weighting model.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weighting</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weighting</span> <span class="o">=</span> <span class="n">weighting</span>

    <span class="k">def</span> <span class="nf">scorer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">searcher</span><span class="p">,</span> <span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">qf</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">subscorer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weighting</span><span class="o">.</span><span class="n">scorer</span><span class="p">(</span><span class="n">searcher</span><span class="p">,</span> <span class="n">fieldname</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">qf</span><span class="o">=</span><span class="n">qf</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ReverseWeighting</span><span class="o">.</span><span class="n">ReverseScorer</span><span class="p">(</span><span class="n">subscorer</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">ReverseScorer</span><span class="p">(</span><span class="n">BaseScorer</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subscorer</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subscorer</span> <span class="o">=</span> <span class="n">subscorer</span>

        <span class="k">def</span> <span class="nf">supports_block_quality</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">subscorer</span><span class="o">.</span><span class="n">supports_block_quality</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matcher</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">subscorer</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">matcher</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">max_quality</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">subscorer</span><span class="o">.</span><span class="n">max_quality</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">block_quality</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matcher</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">subscorer</span><span class="o">.</span><span class="n">block_quality</span><span class="p">(</span><span class="n">matcher</span><span class="p">)</span></div>


<span class="c1"># class PositionWeighting(WeightingModel):</span>
<span class="c1">#    def __init__(self, reversed=False):</span>
<span class="c1">#        self.reversed = reversed</span>
<span class="c1">#</span>
<span class="c1">#    def scorer(self, searcher, fieldname, text, qf=1):</span>
<span class="c1">#        return PositionWeighting.PositionScorer()</span>
<span class="c1">#</span>
<span class="c1">#    class PositionScorer(BaseScorer):</span>
<span class="c1">#        def score(self, matcher):</span>
<span class="c1">#            p = min(span.pos for span in matcher.spans())</span>
<span class="c1">#            if self.reversed:</span>
<span class="c1">#                return p</span>
<span class="c1">#            else:</span>
<span class="c1">#                return 0 - p</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2007-2012 Matt Chaput.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>